---
phase: 06-action-coverage-gap-closure
plan: 01
type: execute
wave: 1
depends_on: []
gap_closure: true
files_modified:
  - src/shared/loading/useActionLoading.ts
  - src/shared/loading/index.ts
  - src/shared/loading/loading-messages.ts
  - src/shared/loading/loading-messages.test.ts
  - src/shared/loading/FullPageLoadingScreen.tsx
  - src/shared/components/ProgressViewport.tsx
  - .planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
autonomous: true
requirements: [FLOW-03, FLOW-04, QUAL-03]
user_setup: []
must_haves:
  truths:
    - "A single mandatory action-loading wrapper exists and enforces explicit action message keys for all critical mutation handlers."
    - "Unknown action keys still show user fallback `Lade...` and additionally emit a development warning for gap detection."
    - "Long-running action flows can display full-page loading and progress viewport together without hiding progress details."
    - "Phase 6 async flow inventory exists with one row per user-triggered flow and required status model (`Not covered`, `Covered`, `Verified`)."
  artifacts:
    - path: src/shared/loading/useActionLoading.ts
      provides: reusable strict action wrapper over shared loading lifecycle
      min_lines: 35
    - path: src/shared/loading/loading-messages.ts
      provides: expanded domain-specific action key registry for profile/team/owner/busflow mutations
      min_lines: 80
    - path: .planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
      provides: flow-level coverage inventory baseline and evidence columns
      min_lines: 50
  key_links:
    - from: src/shared/loading/useActionLoading.ts
      to: src/shared/loading/LoadingProvider.tsx
      via: wrapper delegates every action operation to token-safe shared loading lifecycle
    - from: src/shared/loading/useActionLoading.ts
      to: src/shared/loading/loading-messages.ts
      via: wrapper validates action message-key coverage and warns in dev when unresolved
    - from: src/shared/loading/FullPageLoadingScreen.tsx
      to: src/shared/components/ProgressViewport.tsx
      via: layering contract keeps progress and global loading concurrently visible for long-running actions
---

<objective>
Define the shared action-loading contract, key governance, and inventory baseline for Phase 6 rollout.

Purpose: Lock one mandatory implementation path before domain wiring so FLOW-03/FLOW-04/QUAL-03 are enforceable instead of ad hoc.
Output: strict `useActionLoading` wrapper, expanded domain action keys, coexistence layering contract, and required `06-ASYNC-FLOW-INVENTORY.md` scaffold.
</objective>

<execution_context>
@/Users/tillschafer/.codex/get-shit-done/workflows/execute-plan.md
@/Users/tillschafer/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/06-action-coverage-gap-closure/06-CONTEXT.md
@.planning/phases/06-action-coverage-gap-closure/06-RESEARCH.md
@src/shared/loading/LoadingProvider.tsx
@src/shared/loading/loading-messages.ts
@src/shared/loading/FullPageLoadingScreen.tsx
@src/shared/components/ProgressViewport.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mandatory action-loading wrapper contract</name>
  <files>
    src/shared/loading/useActionLoading.ts
    src/shared/loading/index.ts
  </files>
  <action>
    Create a reusable `useActionLoading` hook in `src/shared/loading/` that wraps `useLoading().runWithLoading` and hard-sets `scope: 'action'`.
    Enforce explicit non-empty `messageKey` (throw when missing/blank).
    Add dev-only warning for unresolved keys via `resolveScopedLoadingMessage('action', messageKey)` while preserving user fallback behavior.
    Export the new hook from `src/shared/loading/index.ts`.
  </action>
  <verify>
    <automated>npm run typecheck</automated>
  </verify>
  <done>All mutation domains can call one shared wrapper that enforces key discipline and shared cleanup semantics.</done>
</task>

<task type="auto">
  <name>Task 2: Expand domain-specific action message registry and coverage tests</name>
  <files>
    src/shared/loading/loading-messages.ts
    src/shared/loading/loading-messages.test.ts
  </files>
  <action>
    Expand `action.*` keys beyond generic save/delete/import to domain-specific entries needed by AppRouter, TeamAdmin, PlatformAdmin, and BusFlow handlers.
    Keep German short verb phrasing and include explicit invite/security flow keys.
    Preserve fallback `Lade...` behavior and add/extend tests for:
    - known domain keys resolve correctly
    - unknown keys still resolve fallback
    - wrapper warning preconditions stay possible (resolver returns null for unknown keys)
  </action>
  <verify>
    <automated>npm run test -- src/shared/loading/loading-messages.test.ts</automated>
  </verify>
  <done>Registry can express all Phase 6 action flows with explicit domain-specific loading messages and tested fallback behavior.</done>
</task>

<task type="auto">
  <name>Task 3: Establish progress+global-loader coexistence contract and create Phase 6 inventory baseline</name>
  <files>
    src/shared/loading/FullPageLoadingScreen.tsx
    src/shared/components/ProgressViewport.tsx
    .planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
  </files>
  <action>
    Implement a deterministic layering/composition rule so long-running action flows can show full-page loading and progress viewport simultaneously.
    Ensure progress remains readable while global loader is active and blocking defaults for actions stay unchanged.
    Create `.planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md` with one row per user-triggered critical flow, columns for code location/message key/status/evidence, and initial status `Not covered` for all rows.
  </action>
  <verify>
    <automated>npm run typecheck && npm run lint</automated>
  </verify>
  <done>Coexistence rule is codified and Phase 6 inventory exists as the authoritative QUAL-03 baseline artifact.</done>
</task>

</tasks>

<verification>
A strict wrapper, domain-specific key registry, and inventory baseline are in place before action rollout.
</verification>

<success_criteria>
- [ ] `useActionLoading` exists, is exported, and enforces explicit action keys.
- [ ] Domain-specific profile/team/owner/busflow action keys are present with fallback-safe tests.
- [ ] Progress viewport remains visible with full-page action loading during long-running operations.
- [ ] `06-ASYNC-FLOW-INVENTORY.md` exists with all critical flows initialized to `Not covered`.
</success_criteria>

<output>
After completion, create `.planning/phases/06-action-coverage-gap-closure/06-01-SUMMARY.md`
</output>
