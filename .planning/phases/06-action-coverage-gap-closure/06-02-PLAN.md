---
phase: 06-action-coverage-gap-closure
plan: 02
type: execute
wave: 2
depends_on: [01]
gap_closure: true
files_modified:
  - src/app/router/AppRouter.tsx
  - src/pages/TeamAdmin.tsx
  - src/pages/PlatformAdmin.tsx
  - .planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
autonomous: true
requirements: [FLOW-03, FLOW-04, QUAL-03]
user_setup: []
must_haves:
  truths:
    - "Profile security, team admin, and platform owner mutation handlers execute through the shared action-loading wrapper with explicit domain message keys."
    - "Concurrent actions in these domains keep global loading active until all action tokens settle, even when one action fails."
    - "Inventory rows for each migrated flow are updated in the same change from `Not covered` to `Covered` with code evidence."
  artifacts:
    - path: src/app/router/AppRouter.tsx
      provides: profile security actions wrapped in shared global action loading
      min_lines: 360
    - path: src/pages/TeamAdmin.tsx
      provides: invite/manage/delete team mutations wired to strict action wrapper
      min_lines: 260
    - path: src/pages/PlatformAdmin.tsx
      provides: owner create/save/archive/reactivate/trial/delete flows wired to strict action wrapper
      min_lines: 520
    - path: .planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
      provides: same-change coverage status updates and evidence for wired flows
      min_lines: 60
  key_links:
    - from: src/app/router/AppRouter.tsx
      to: src/shared/loading/useActionLoading.ts
      via: profile security actions call mandatory wrapper with explicit keys
    - from: src/pages/TeamAdmin.tsx
      to: src/shared/loading/useActionLoading.ts
      via: invite/role/delete/resend flows are globally action-tracked with token cleanup
    - from: src/pages/PlatformAdmin.tsx
      to: src/shared/loading/useActionLoading.ts
      via: owner mutation lifecycle runs through shared wrapper while local busy UX remains
---

<objective>
Roll out shared action-loading integration across Profile, TeamAdmin, and PlatformAdmin critical mutation flows.

Purpose: Close the largest FLOW-03/FLOW-04 gaps while preserving existing local busy/toast UX semantics.
Output: All in-scope profile/team/owner handlers wrapped with explicit domain action keys and synced inventory updates.
</objective>

<execution_context>
@/Users/tillschafer/.codex/get-shit-done/workflows/execute-plan.md
@/Users/tillschafer/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-action-coverage-gap-closure/06-CONTEXT.md
@.planning/phases/06-action-coverage-gap-closure/06-RESEARCH.md
@.planning/phases/06-action-coverage-gap-closure/06-01-SUMMARY.md
@src/app/router/AppRouter.tsx
@src/pages/TeamAdmin.tsx
@src/pages/PlatformAdmin.tsx
@src/shared/loading/useActionLoading.ts
@.planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire profile security action handlers to shared loading wrapper</name>
  <files>
    src/app/router/AppRouter.tsx
    .planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
  </files>
  <action>
    Integrate `useActionLoading` into `handleProfileAvatarSave`, `handleProfileEmailChangeRequest`, and `handleProfilePasswordResetRequest`.
    Keep existing `is...Submitting` flags and toast messaging intact; only add global action loading lifecycle around each user-triggered mutation boundary.
    Use explicit domain keys (for example `action.profile.avatar.save`, `action.profile.email.change`, `action.profile.password.reset`).
    Update matching inventory rows in the same change to `Covered` with file/handler evidence.
  </action>
  <verify>
    <automated>npm run typecheck && npm run lint -- src/app/router/AppRouter.tsx</automated>
  </verify>
  <done>Profile security actions consistently trigger global action loading without regressing local UX controls.</done>
</task>

<task type="auto">
  <name>Task 2: Wire TeamAdmin mutation handlers and preserve error-path cleanup</name>
  <files>
    src/pages/TeamAdmin.tsx
    .planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
  </files>
  <action>
    Wrap TeamAdmin critical mutations (`handleInviteEmployee`, `handleUpdateMembershipRole`, `handleDeleteUserHard`, `handleDeleteInvitation`, `handleResendInvitation`) with `useActionLoading` and explicit keys.
    Preserve existing guard clauses, confirm-dialog busy states, and code-specific toast behavior.
    Ensure failure branches still surface toasts while global loading remains correct for overlapping actions.
    Update all corresponding inventory rows to `Covered` in the same change with evidence notes.
  </action>
  <verify>
    <automated>npm run typecheck && npm run lint -- src/pages/TeamAdmin.tsx</automated>
  </verify>
  <done>Team admin invite/manage/delete flows are globally action-tracked with concurrency-safe lifecycle cleanup.</done>
</task>

<task type="auto">
  <name>Task 3: Wire PlatformAdmin mutation handlers and update coverage inventory</name>
  <files>
    src/pages/PlatformAdmin.tsx
    .planning/phases/06-action-coverage-gap-closure/06-ASYNC-FLOW-INVENTORY.md
  </files>
  <action>
    Apply `useActionLoading` to owner mutation handlers (`handleCreateAccountAndInviteAdmin`, `handleSaveEdit`, `handleArchive`, `handleReactivate`, `handleTrialAction`, `handleDeleteHard`) with explicit owner-domain keys.
    Keep modal state transitions and existing toast semantics unchanged.
    Ensure each wrapper boundary includes mutation + required data refresh so loading lifecycle represents the full user action.
    Update inventory rows to `Covered` in the same change, including code evidence per handler.
  </action>
  <verify>
    <automated>npm run typecheck && npm run lint -- src/pages/PlatformAdmin.tsx</automated>
  </verify>
  <done>Owner mutation lifecycle is fully integrated with shared action loading and traceable in inventory.</done>
</task>

</tasks>

<verification>
Profile/team/owner mutation flows are covered by mandatory shared action loading with same-change inventory proof.
</verification>

<success_criteria>
- [ ] AppRouter profile security handlers use explicit domain action keys via wrapper.
- [ ] TeamAdmin invite/manage/delete handlers use wrapper and preserve existing busy/toast UX.
- [ ] PlatformAdmin create/save/archive/reactivate/trial/delete handlers use wrapper and full-action boundaries.
- [ ] Inventory rows for all wired profile/team/owner flows are set to `Covered` with evidence.
</success_criteria>

<output>
After completion, create `.planning/phases/06-action-coverage-gap-closure/06-02-SUMMARY.md`
</output>
